<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Admin Dashboard | Barford Golf Society</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --green:#005a2b; --gold:#d4af37;
  --dark-bg:#1b1b1b; --dark-card:#2b2b2b;
  --light-bg:#f7f7f5; --light-card:#ffffff;
}
body {
  font-family:"Inter",sans-serif; margin:0;
  background:var(--light-bg); color:#1b1b1b;
  transition:background .3s,color .3s;
}
.dark { background:var(--dark-bg); color:#eee; }
.site-header,footer{background:var(--green);color:#fff;padding:15px 0;}
.header-container{display:flex;justify-content:space-between;align-items:center;max-width:1200px;margin:0 auto;padding:0 20px;}
.site-title{color:var(--gold);}
.site-nav ul{list-style:none;display:flex;gap:20px;margin:0;padding:0;}
.site-nav a{color:#fff;text-decoration:none;font-weight:600;}
.site-nav a:hover,.active{color:var(--gold);}
#login,#dashboard{max-width:1200px;margin:40px auto;padding:20px;}
input,select,textarea{font-family:inherit;padding:8px;border-radius:6px;border:1px solid #ccc;}
button{background:var(--green);color:#fff;border:none;border-radius:6px;padding:8px 14px;font-weight:600;cursor:pointer;margin:4px;transition:background .3s,transform .2s;}
button:hover{background:#0a6b34;transform:scale(1.02);}
button.danger{background:#b22222;}
button.gold{background:var(--gold);color:#1b1b1b;}
.hidden{display:none;}
footer{text-align:center;color:var(--gold);border-top:4px solid var(--gold);padding:20px;margin-top:40px;}
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin-top:20px;}
.card{background:var(--light-card);padding:20px;border-radius:12px;box-shadow:0 3px 10px rgba(0,0,0,0.1);text-align:center;transition:transform .2s;}
.card:hover{transform:translateY(-3px);}
.dark .card{background:var(--dark-card);color:#eee;}
.tabs{display:flex;flex-wrap:wrap;gap:10px;margin-top:20px;}
.tab-btn{background:var(--gold);color:#1b1b1b;}
.tab-btn.active{background:var(--green);color:#fff;}
.tab-content{display:none;margin-top:20px;}
.tab-content.active{display:block;}
table{width:100%;border-collapse:collapse;background:var(--light-card);border-radius:12px;overflow:hidden;}
th,td{padding:10px;text-align:center;border-bottom:1px solid #ccc;}
th{background:var(--green);color:var(--gold);}
textarea#adminNotes{width:100%;height:150px;resize:none;margin-top:10px;}
.activity-feed{max-height:300px;overflow-y:auto;padding:10px;border:1px solid #ccc;border-radius:8px;background:var(--light-card);}
.toggle{position:fixed;top:10px;right:10px;background:var(--gold);color:#1b1b1b;padding:8px 10px;border-radius:8px;font-weight:700;cursor:pointer;}
.dark .toggle{background:#333;color:var(--gold);}
h3 small{font-weight:400;color:#666;font-size:0.9rem;}
</style>
</head>
<body>

<header class="site-header">
  <div class="header-container">
    <h1 class="site-title">Barford Golf Society</h1>
    <nav class="site-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="scores.html">Scores</a></li>
        <li><a href="admin.html" class="active">Admin</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="toggle" onclick="toggleDarkMode()">üåô</div>

<section id="login">
  <h2>Admin Login</h2>
  <input type="password" id="pw" placeholder="Enter admin password">
  <button onclick="unlock()">Unlock</button>
</section>

<section id="dashboard" class="hidden">
  <h2>Welcome, Admin üëã</h2>
  <div class="cards" id="statsCards"></div>

  <div class="tabs">
    <button class="tab-btn active" data-tab="overview">Overview</button>
    <button class="tab-btn" data-tab="rsvps">RSVPs</button>
    <button class="tab-btn" data-tab="events">Events</button>
    <button class="tab-btn" data-tab="gallery">Gallery</button>
    <button class="tab-btn" data-tab="teetimes">Tee Times</button>
    <button class="tab-btn" data-tab="notes">Notes</button>
    <button class="tab-btn" data-tab="activity">Activity</button>
  </div>

  <!-- Overview -->
  <div id="overview" class="tab-content active">
    <h3>RSVP Overview</h3>
    <canvas id="rsvpChart" height="120"></canvas>
  </div>

  <!-- Tee Time Organiser -->
  <div id="teetimes" class="tab-content">
    <h3>Tee Time Organiser <small></small></h3>
    <div id="teeLogin">
      <input type="password" id="teePw" placeholder="Enter tee organiser password">
      <button onclick="unlockTeeTime()">Unlock</button>
    </div>

    <div id="teeContent" class="hidden">
      <label>First Tee Time:</label>
      <input type="time" id="firstTeeTime" value="09:00">
      <label>Interval (mins):</label>
      <select id="teeInterval"><option>5</option><option selected>7</option><option>10</option></select>
      <br><br>
      <label>Attach to Event:</label>
      <select id="eventSelect"></select>
      <br>
      <button class="gold" onclick="generateTeeTimes()">Generate Tee Times</button>
      <button class="gold hidden" id="postTeeTimesBtn" onclick="postTeeTimes()">Post to Event Page</button>
      <table id="teeSheetTable"><thead><tr><th>Tee Time</th><th>Player 1</th><th>Player 2</th><th>Player 3</th><th>Player 4</th><th>Buggy?</th></tr></thead><tbody></tbody></table>
    </div>
  </div>

  <!-- RSVPs -->
  <div id="rsvps" class="tab-content">
    <h3>RSVP Manager</h3>
    <div><button class="gold" onclick="downloadCsv('rsvps')">Download CSV</button>
    <button class="danger" onclick="clearData('bgsRsvps')">Clear All RSVPs</button></div>
    <table id="rsvpTable"><thead><tr><th>Event</th><th>Attending</th><th>Handicap</th><th>Buggy</th><th>Partner</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- Events -->
  <div id="events" class="tab-content">
    <h3>Event Manager</h3>
    <table id="eventTable"><thead><tr><th>Name</th><th>Location</th><th>Date</th><th>Price</th><th>Actions</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- Gallery -->
  <div id="gallery" class="tab-content">
    <h3>Gallery Manager</h3>
    <table id="galleryTable"><thead><tr><th>Preview</th><th>Uploader</th><th>Status</th><th>Actions</th></tr></thead><tbody></tbody></table>
  </div>

  <!-- Notes -->
  <div id="notes" class="tab-content">
    <h3>Admin Notes</h3>
    <textarea id="adminNotes" placeholder="Write reminders or to-dos..."></textarea>
  </div>

  <!-- Activity -->
  <div id="activity" class="tab-content">
    <h3>Recent Activity</h3>
    <div class="activity-feed" id="activityFeed"></div>
  </div>
</section>

<footer><p>¬© 2025 Barford Golf Society</p></footer>

<script>
const PASSWORD="westbrom1997", TEE_PASSWORD="oxford1";
const qs=s=>document.querySelector(s), qsa=s=>document.querySelectorAll(s);

function unlock(){
  if(qs('#pw').value.trim()!==PASSWORD)return alert("Incorrect password");
  qs('#login').classList.add('hidden');
  qs('#dashboard').classList.remove('hidden');
  renderAll();
}

function unlockTeeTime(){
  if(qs('#teePw').value.trim()!==TEE_PASSWORD)return alert("Incorrect password");
  qs('#teeLogin').classList.add('hidden');
  qs('#teeContent').classList.remove('hidden');
  populateEventSelect();
}

function toggleDarkMode(){
  document.body.classList.toggle('dark');
  localStorage.setItem('bgsDarkMode',document.body.classList.contains('dark'));
  qs('.toggle').textContent=document.body.classList.contains('dark')?'‚òÄÔ∏è':'üåô';
}
if(localStorage.getItem('bgsDarkMode')==='true'){document.body.classList.add('dark');qs('.toggle').textContent='‚òÄÔ∏è';}

function populateEventSelect(){
  const evts=JSON.parse(localStorage.getItem('bgsEvents')||'[]');
  qs('#eventSelect').innerHTML=evts.map(e=>`<option value="${e.name}">${e.name}</option>`).join('');
}

/* Generate Tee Times */
function generateTeeTimes(){
  const rsvps=JSON.parse(localStorage.getItem('bgsRsvps')||'[]').filter(r=>r.attend?.toLowerCase()==='yes');
  if(!rsvps.length)return alert("No RSVPs found.");
  const start=qs('#firstTeeTime').value;const interval=parseInt(qs('#teeInterval').value);
  const groups=groupPlayers(rsvps);const tbody=qs('#teeSheetTable tbody');
  tbody.innerHTML='';let t=new Date(`2000-01-01T${start}`);
  groups.forEach(g=>{
    const time=t.toTimeString().slice(0,5);
    const buggy=g.some(p=>p.buggy==='Yes')?'Yes':'No';
    const cells=g.map(p=>`<td>${p.name||'Player'}</td>`).join('');
    tbody.innerHTML+=`<tr><td>${time}</td>${cells}<td>${buggy}</td></tr>`;
    t.setMinutes(t.getMinutes()+interval);
  });
  qs('#postTeeTimesBtn').classList.remove('hidden');
  localStorage.setItem('tempTeeTimes',JSON.stringify(groups));
}

function postTeeTimes(){
  const selectedEvent=qs('#eventSelect').value;
  const teeData=JSON.parse(localStorage.getItem('tempTeeTimes')||'[]');
  if(!teeData.length)return alert("No tee times generated.");
  localStorage.setItem('teeTimes_'+selectedEvent,JSON.stringify(teeData));
  alert(`‚úÖ Tee times posted to "${selectedEvent}"`);
  logActivity(`Tee times posted for ${selectedEvent}`);
}

/* Grouping logic */
function groupPlayers(players){
  const pairs=[],used=new Set();
  players.forEach(p=>{
    if(p.buggy?.toLowerCase()==='yes'&&p.partner){
      const partner=players.find(x=>x.name===p.partner);
      if(partner&&!used.has(p.name)&&!used.has(partner.name)){
        pairs.push([p,partner]);used.add(p.name);used.add(partner.name);
      }
    }
  });
  const remaining=players.filter(p=>!used.has(p.name));
  const all=[...pairs.flat(),...remaining].sort(()=>Math.random()-0.5);
  const groups=[];
  while(all.length>0)groups.push(all.splice(0,4));
  if(groups.length>1&&groups.at(-1).length===1)groups.at(-2).push(groups.pop()[0]);
  return groups;
}

/* Data and charts */
function renderAll(){
  updateStats();loadRsvps();loadEvents();loadGallery();loadNotes();loadActivity();buildChart();populateEventSelect();
}
function updateStats(){
  const evts=JSON.parse(localStorage.getItem('bgsEvents')||'[]');
  const rsvps=JSON.parse(localStorage.getItem('bgsRsvps')||'[]');
  const gallery=JSON.parse(localStorage.getItem('bgsGalleryUploads')||'[]');
  const next=evts.sort((a,b)=>new Date(a.date)-new Date(b.date))[0];
  qs('#statsCards').innerHTML=`
    <div class="card"><h3>üèåÔ∏è Active Events</h3><p>${evts.length}</p></div>
    <div class="card"><h3>üë• Total RSVPs</h3><p>${rsvps.length}</p></div>
    <div class="card"><h3>üñºÔ∏è Approved Photos</h3><p>${gallery.filter(p=>p.approved).length}</p></div>
    <div class="card"><h3>üìÖ Next Event</h3><p>${next?next.name+"<br>"+next.date:"None"}</p></div>`;
}
function loadRsvps(){
  const data=JSON.parse(localStorage.getItem('bgsRsvps')||'[]');
  const tbody=qs('#rsvpTable tbody');tbody.innerHTML='';
  data.forEach(r=>{tbody.innerHTML+=`<tr><td>${r.event}</td><td>${r.attend}</td><td>${r.handicap||''}</td><td>${r.buggy||''}</td><td>${r.partner||''}</td></tr>`});
}
function loadEvents(){
  const data=JSON.parse(localStorage.getItem('bgsEvents')||'[]');
  const tbody=qs('#eventTable tbody');tbody.innerHTML='';
  data.forEach((e,i)=>{tbody.innerHTML+=`<tr><td>${e.name}</td><td>${e.location}</td><td>${e.date}</td><td>${e.price}</td><td><button class="danger" onclick="deleteEvent(${i})">Delete</button></td></tr>`});
}
function loadGallery(){
  const data=JSON.parse(localStorage.getItem('bgsGalleryUploads')||'[]');
  const tbody=qs('#galleryTable tbody');tbody.innerHTML='';
  data.forEach((g,i)=>{tbody.innerHTML+=`<tr><td><img src="${g.url}" alt="" width="80" style="border-radius:8px"></td><td>${g.uploader||'Unknown'}</td><td>${g.approved?'‚úÖ Approved':'‚è≥ Pending'}</td><td>${!g.approved?`<button class="gold" onclick="approvePhoto(${i})">Approve</button>`:''}<button class="danger" onclick="deletePhoto(${i})">Delete</button></td></tr>`});
}
function approvePhoto(i){
  const d=JSON.parse(localStorage.getItem('bgsGalleryUploads')||'[]');
  d[i].approved=true;localStorage.setItem('bgsGalleryUploads',JSON.stringify(d));logActivity('Photo approved');loadGallery();updateStats();
}
function deletePhoto(i){
  const d=JSON.parse(localStorage.getItem('bgsGalleryUploads')||'[]');
  d.splice(i,1);localStorage.setItem('bgsGalleryUploads',JSON.stringify(d));logActivity('Photo deleted');loadGallery();updateStats();
}
function deleteEvent(i){
  const d=JSON.parse(localStorage.getItem('bgsEvents')||'[]');
  logActivity(`Event "${d[i].name}" deleted`);d.splice(i,1);
  localStorage.setItem('bgsEvents',JSON.stringify(d));loadEvents();updateStats();
}
function clearData(key){
  if(prompt("Confirm password")==PASSWORD){
    localStorage.removeItem(key);logActivity(`${key} cleared`);renderAll();
  }
}
function downloadCsv(type){
  let data,headers,rows;
  if(type==='rsvps'){
    data=JSON.parse(localStorage.getItem('bgsRsvps')||'[]');
    headers=["Event","Attending","Handicap","Buggy","Partner"];
    rows=data.map(d=>[d.event,d.attend,d.handicap||'',d.buggy||'',d.partner||'']);
  }else{
    data=JSON.parse(localStorage.getItem('bgsEvents')||'[]');
    headers=["Name","Location","Date","Price"];
    rows=data.map(e=>[e.name,e.location,e.date,e.price]);
  }
  const csv=headers.join(',')+'\n'+rows.map(r=>r.join(',')).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a');a.href=URL.createObjectURL(blob);
  a.download=`BGS_${type}_${Date.now()}.csv`;a.click();
}
function loadNotes(){
  qs('#adminNotes').value=localStorage.getItem('bgsAdminNotes')||'';
  qs('#adminNotes').oninput=()=>localStorage.setItem('bgsAdminNotes',qs('#adminNotes').value);
}
function logActivity(m){
  const a=JSON.parse(localStorage.getItem('bgsActivityFeed')||'[]');
  a.unshift({msg:m,time:new Date().toLocaleString()});
  localStorage.setItem('bgsActivityFeed',JSON.stringify(a.slice(0,100)));
  loadActivity();
}
function loadActivity(){
  const a=JSON.parse(localStorage.getItem('bgsActivityFeed')||'[]');
  qs('#activityFeed').innerHTML=a.map(x=>`<p>‚Ä¢ ${x.time} ‚Äî ${x.msg}</p>`).join('');
}
function buildChart(){
  const ctx=document.getElementById('rsvpChart');
  const rsvps=JSON.parse(localStorage.getItem('bgsRsvps')||'[]');
  const events=[...new Set(rsvps.map(r=>r.event))];
  const counts=events.map(ev=>rsvps.filter(r=>r.event===ev).length);
  if(window.rsvpChartObj)window.rsvpChartObj.destroy();
  window.rsvpChartObj=new Chart(ctx,{type:'bar',data:{labels:events,datasets:[{label:'RSVP Count',data:counts,backgroundColor:'rgba(0,90,43,0.7)'}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}}}});
}
qsa('.tab-btn').forEach(btn=>btn.onclick=()=>{qsa('.tab-btn').forEach(b=>b.classList.remove('active'));btn.classList.add('active');qsa('.tab-content').forEach(c=>c.classList.remove('active'));qs('#'+btn.dataset.tab).classList.add('active');});
</script>
</body>
</html>

