<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Gallery | Barford Golf Society</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --green:#005a2b; --gold:#d4af37; --ink:#1b1b1b; --bg:#f7f7f5;
  }
  body{font-family:"Inter",sans-serif;background:var(--bg);color:var(--ink);margin:0;}
  .site-header, footer{background:var(--green);color:#fff;padding:15px 0;}
  .header-container{display:flex;justify-content:space-between;align-items:center;max-width:1100px;margin:0 auto;padding:0 20px;}
  .site-title{color:var(--gold);margin:0;}
  .site-nav ul{list-style:none;display:flex;gap:20px;margin:0;padding:0;}
  .site-nav a{color:#fff;text-decoration:none;font-weight:600;}
  .site-nav a:hover,.active{color:var(--gold);}

  /* Banner slideshow */
  .banner{position:relative;width:100%;height:60vh;min-height:340px;background:#000;overflow:hidden;}
  .banner img{position:absolute;inset:0;width:100%;height:100%;object-fit:contain;background:#000;opacity:0;transition:opacity 1s ease-in-out;cursor:pointer;}
  .banner img.active{opacity:1;}
  .arrow{position:absolute;top:50%;transform:translateY(-50%);color:#fff;font-size:2.2rem;background:rgba(0,0,0,.45);border-radius:50%;padding:8px 14px;cursor:pointer;user-select:none;z-index:10}
  .arrow.left{left:20px;} .arrow.right{right:20px;}
  .arrow:hover{background:rgba(0,0,0,.75);}

  /* Page layout */
  .container{max-width:1100px;margin:40px auto;padding:0 20px;}
  .upload-box{background:#fff;padding:20px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,.1);text-align:center;}
  .upload-box h2{color:var(--green);margin:0 0 10px;}
  .preview{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:12px;}
  .preview img{width:150px;height:100px;object-fit:cover;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.08);}
  .btn{background:var(--green);color:#fff;border:none;border-radius:6px;padding:10px 16px;font-weight:700;cursor:pointer}
  .btn:hover{filter:brightness(1.05);}
  .btn.red{background:#b22222}
  .btn.red:hover{filter:brightness(1.1)}

  /* Gallery grid with delete button BELOW each photo */
  .gallery-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-top:28px;}
  .tile{background:#fff;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,.08);overflow:hidden;display:flex;flex-direction:column}
  .tile img{width:100%;height:180px;object-fit:cover;cursor:pointer;}
  .tile .tile-actions{padding:10px;display:flex;justify-content:center;gap:8px;border-top:1px solid #eee;}
  .tile .meta{padding:8px 10px;color:#666;font-size:.9rem;display:none;} /* reserved if you want captions later */

  /* Lightbox */
  .lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:9999;justify-content:center;align-items:center}
  .lightbox img{max-width:90%;max-height:85%;object-fit:contain;border-radius:10px}
  .lightbox .close{position:absolute;top:18px;right:30px;color:#fff;font-size:2rem;cursor:pointer}
  .lightbox .lb-arrow{position:absolute;top:50%;transform:translateY(-50%);color:#fff;font-size:2.2rem;background:rgba(255,255,255,.15);border-radius:50%;padding:8px 14px;cursor:pointer;user-select:none}
  .lightbox .lb-left{left:30px} .lightbox .lb-right{right:30px}
  .lightbox .lb-arrow:hover{background:rgba(255,255,255,.3)}

  footer{text-align:center;color:var(--gold);border-top:4px solid var(--gold);margin-top:40px;padding:20px;}
</style>
</head>
<body>
<header class="site-header">
  <div class="header-container">
    <h1 class="site-title">Barford Golf Society</h1>
    <nav class="site-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="events.html">Events</a></li>
        <li><a href="scores.html">Scores</a></li>
        <li><a href="gallery.html" class="active">Gallery</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </div>
</header>

<!-- Banner -->
<div class="banner" id="banner">
  <div class="arrow left" onclick="prevSlide()">&#10094;</div>
  <div class="arrow right" onclick="nextSlide()">&#10095;</div>
</div>

<!-- Upload -->
<div class="container">
  <div class="upload-box">
    <h2>Upload Your Golf Photos</h2>
    <input type="file" id="fileInput" accept="image/*" multiple>
    <div class="preview" id="preview"></div>
    <button id="approveBtn" class="btn" style="display:none" onclick="approveUploads()">Approve Uploads</button>
  </div>

  <h3 style="color:var(--green);text-align:center;margin-top:32px;">Gallery</h3>
  <div class="gallery-grid" id="galleryGrid"></div>
</div>

<!-- Lightbox -->
<div class="lightbox" id="lightbox">
  <span class="close" onclick="closeLightbox()">×</span>
  <div class="lb-arrow lb-left" onclick="lbPrev()">&#10094;</div>
  <img id="lightboxImg" src="">
  <div class="lb-arrow lb-right" onclick="lbNext()">&#10095;</div>
</div>

<footer><p>© 2025 Barford Golf Society</p></footer>

<script>
/* ===== CONFIG ===== */
const ADMIN_PASSWORD = "westbrom1997";
const STORAGE_KEY = "bgsGallery"; // array of data URLs (already resized)

/* ===== STATE ===== */
let gallery = JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
let previewFiles = [];
let currentIndex = 0;
let lightboxIndex = 0;

/* ===== DOM ===== */
const banner = document.getElementById("banner");
const preview = document.getElementById("preview");
const approveBtn = document.getElementById("approveBtn");
const grid = document.getElementById("galleryGrid");
const lightbox = document.getElementById("lightbox");
const lightboxImg = document.getElementById("lightboxImg");

/* ===== RENDER: BANNER ===== */
function renderBanner(){
  // clear previous images
  banner.querySelectorAll("img.banner-img, p.empty").forEach(n=>n.remove());
  if(!gallery.length){
    const p=document.createElement("p");
    p.textContent="No photos yet";
    p.className="empty";
    p.style.color="#fff"; p.style.textAlign="center"; p.style.margin="0 auto";
    banner.appendChild(p);
    return;
  }
  gallery.forEach((src,i)=>{
    const img=document.createElement("img");
    img.className="banner-img";
    img.src=src;
    img.classList.toggle("active", i===currentIndex);
    img.addEventListener("click", ()=>openLightbox(i));
    banner.appendChild(img);
  });
}
function nextSlide(){
  if(!gallery.length) return;
  currentIndex=(currentIndex+1)%gallery.length;
  updateBannerActive();
}
function prevSlide(){
  if(!gallery.length) return;
  currentIndex=(currentIndex-1+gallery.length)%gallery.length;
  updateBannerActive();
}
function updateBannerActive(){
  document.querySelectorAll(".banner-img").forEach((img,i)=>img.classList.toggle("active", i===currentIndex));
}
setInterval(nextSlide, 5000);

/* ===== RENDER: GRID (with delete button BELOW) ===== */
function renderGrid(){
  grid.innerHTML="";
  gallery.forEach((src,i)=>{
    const tile=document.createElement("div");
    tile.className="tile";

    const img=document.createElement("img");
    img.src=src;
    img.alt=`Photo ${i+1}`;
    img.addEventListener("click", ()=>openLightbox(i));

    const actions=document.createElement("div");
    actions.className="tile-actions";
    const del=document.createElement("button");
    del.className="btn red";
    del.textContent="Delete";
    del.addEventListener("click", (e)=>{
      e.stopPropagation();
      requestDelete(i);
    });

    actions.appendChild(del);
    tile.appendChild(img);
    tile.appendChild(actions);
    grid.appendChild(tile);
  });
}

/* ===== LIGHTBOX ===== */
function openLightbox(i){
  lightboxIndex = i;
  lightboxImg.src = gallery[lightboxIndex];
  lightbox.style.display = "flex";
}
function closeLightbox(){ lightbox.style.display="none"; }
function lbNext(){ if(!gallery.length) return; lightboxIndex=(lightboxIndex+1)%gallery.length; lightboxImg.src=gallery[lightboxIndex]; }
function lbPrev(){ if(!gallery.length) return; lightboxIndex=(lightboxIndex-1+gallery.length)%gallery.length; lightboxImg.src=gallery[lightboxIndex]; }

/* ===== DELETE (password-protected) ===== */
function requestDelete(i){
  const pw=prompt("Enter admin password to delete this photo:");
  if(pw!==ADMIN_PASSWORD){ alert("Incorrect password."); return; }
  if(!confirm("Delete this photo?")) return;

  // remove and persist
  gallery.splice(i,1);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(gallery));

  // fix indices if needed
  if(currentIndex >= gallery.length) currentIndex = Math.max(0, gallery.length-1);
  if(lightboxIndex >= gallery.length) lightboxIndex = Math.max(0, gallery.length-1);
  if(!gallery.length) closeLightbox();

  renderBanner();
  renderGrid();
}

/* ===== UPLOAD / PREVIEW ===== */
document.getElementById("fileInput").addEventListener("change", (e)=>{
  preview.innerHTML="";
  previewFiles = Array.from(e.target.files);
  previewFiles.forEach(file=>{
    const rd=new FileReader();
    rd.onload=()=>{ const img=document.createElement("img"); img.src=rd.result; preview.appendChild(img); };
    rd.readAsDataURL(file);
  });
  approveBtn.style.display = previewFiles.length ? "inline-block" : "none";
});

/* Resize to keep localStorage small */
function resizeImage(file, maxWidth=1280, quality=0.8){
  return new Promise(resolve=>{
    const rd=new FileReader();
    rd.onload=e=>{
      const img=new Image();
      img.onload=()=>{
        const scale=Math.min(1, maxWidth/img.width);
        const canvas=document.createElement("canvas");
        canvas.width=img.width*scale;
        canvas.height=img.height*scale;
        const ctx=canvas.getContext("2d");
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        resolve(canvas.toDataURL("image/jpeg", quality));
      };
      img.src=e.target.result;
    };
    rd.readAsDataURL(file);
  });
}

async function approveUploads(){
  if(!previewFiles.length) return alert("No photos selected.");
  try{
    const downsized=[];
    for(const f of previewFiles){ downsized.push(await resizeImage(f)); }
    gallery.push(...downsized);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(gallery));
    previewFiles=[]; preview.innerHTML=""; approveBtn.style.display="none";
    renderBanner(); renderGrid();
    alert("✅ Photos uploaded!");
  }catch(err){
    console.error(err); alert("⚠️ Upload error. Please try again.");
  }
}

/* ===== INIT ===== */
renderBanner();
renderGrid();
</script>
</body>
</html>
