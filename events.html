<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Events | Barford Golf Society</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
:root {
  --green:#005a2b;
  --gold:#d4af37;
  --light-bg:#f7f7f5;
  --card:#fff;
}
body{font-family:"Inter",sans-serif;margin:0;background:var(--light-bg);color:#1b1b1b;}
header,footer{background:var(--green);color:#fff;padding:15px 0;}
.header-container{display:flex;justify-content:space-between;align-items:center;max-width:1100px;margin:0 auto;padding:0 20px;}
.site-title{color:var(--gold);font-size:1.5rem;font-weight:700;}
.site-nav ul{list-style:none;display:flex;gap:20px;margin:0;padding:0;}
.site-nav a{color:#fff;text-decoration:none;font-weight:600;}
.site-nav a:hover,.active{color:var(--gold);}
.container{max-width:1100px;margin:40px auto;padding:0 20px;}
.event-card{background:var(--card);padding:20px;border-radius:10px;margin-bottom:25px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.event-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;}
.event-name{color:var(--green);font-size:1.4rem;font-weight:700;}
.event-image{width:100%;max-height:350px;object-fit:cover;border-radius:10px;margin-top:10px;}
.event-links{margin-top:10px;}
.event-links a{margin-right:10px;color:var(--green);font-weight:600;text-decoration:none;}
.event-links a:hover{text-decoration:underline;}
.event-description{margin-top:10px;white-space:pre-line;}
footer{text-align:center;color:var(--gold);border-top:4px solid var(--gold);margin-top:40px;padding:20px;}

.admin-btn{display:inline-block;background:var(--gold);color:#1b1b1b;font-weight:600;padding:8px 15px;border:none;border-radius:8px;cursor:pointer;margin:10px 0;}
.admin-btn:hover{background:#e0c35a;}
.hidden{display:none;}
.admin-panel{background:#fff;border:2px solid var(--gold);border-radius:10px;padding:20px;margin-bottom:30px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.admin-panel h3{color:var(--green);}
.rsvp-list{background:#fafafa;border:1px solid #ddd;padding:10px;border-radius:8px;margin-top:10px;}
.player-card{background:#fff;border:1px solid #ddd;border-radius:8px;padding:5px;margin:4px 0;cursor:move;font-size:0.95rem;}
.tee-group{background:#f9f9f9;padding:10px;border-radius:8px;margin-bottom:10px;}
.tee-display{margin-top:10px;font-size:0.95rem;}
.tee-display .group{margin-bottom:10px;}
.new-event-form input, .new-event-form textarea {width:100%;margin-bottom:10px;padding:6px;border:1px solid #ccc;border-radius:6px;}
.new-event-form button {background:var(--green);color:#fff;padding:8px 15px;border:none;border-radius:8px;cursor:pointer;font-weight:600;}
.new-event-form button:hover{background:#007a3d;}
</style>
</head>

<body>
<header>
  <div class="header-container">
    <div class="site-title">Barford Golf Society</div>
    <nav class="site-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="events.html" class="active">Events</a></li>
        <li><a href="scores.html">Scores</a></li>
        <li><a href="gallery.html">Gallery</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="container">
  <button id="adminToggle" class="admin-btn" onclick="toggleAdminAccess()">üîê Admin Access</button>

  <div id="adminPanel" class="admin-panel hidden">
    <h3>üßæ Manage Events</h3>
    <div class="new-event-form">
      <h4>‚ûï Create New Event</h4>
      <input type="text" id="newName" placeholder="Event name*" required>
      <input type="date" id="newDate" required>
      <input type="text" id="newLocation" placeholder="Location*" required>
      <input type="number" id="newPrice" placeholder="Price (¬£)" step="0.01">
      <input type="text" id="newImage" placeholder="Image URL">
      <input type="text" id="newCourseLink" placeholder="Course link (optional)">
      <input type="text" id="newWeatherLink" placeholder="Weather link (optional)">
      <textarea id="newDesc" placeholder="Description" rows="3"></textarea>
      <button onclick="createEvent()">Create Event</button>
      <div id="createMsg" style="margin-top:8px;font-weight:600;"></div>
    </div>

    <hr style="margin:20px 0;">

    <h3>üïì Tee Time Generator</h3>
    <label>Select Event</label>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <select id="teeEventSelect" style="width:100%;max-width:400px;margin-bottom:10px;"></select>
      <button onclick="deleteEvent()" style="background:#b22222;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">üóëÔ∏è Delete Selected Event</button>
    </div>
    <div id="playerPool"><em>Players will load once you select an event...</em></div>
    <label>Starting Tee Time</label>
    <input type="text" id="startTime" value="9:00am" style="width:120px;margin-right:10px;">
    <label>Gap (mins)</label>
    <input type="number" id="gapMins" value="7" style="width:60px;">
    <div id="teeGroups" style="margin-top:20px;"></div>
    <button onclick="saveTeeTimes()" style="background:#d4af37;margin-top:15px;">üíæ Save Tee Times</button>
  </div>

  <h2>Upcoming Events</h2>
  <div id="eventList">Loading events...</div>
</div>

<footer><p>¬© 2025 Barford Golf Society</p></footer>

<script>
const ADMIN_PASSWORD = "westbrom1997";
const SUPABASE_URL = "https://tzzkgfehtnuizamzlbgr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6emtnZmVodG51aXphbXpsYmdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MzY5ODAsImV4cCI6MjA3ODAxMjk4MH0.2mf4RMbJJvPo0NApywlrDyHuqAMfMyEWxgOS2ZSP4KQ";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// ---------------------------
// PAGE LOAD
// ---------------------------
window.onload = () => {
  loadEvents();
  if (localStorage.getItem("isAdmin") === "true") {
    document.getElementById("adminPanel").classList.remove("hidden");
    document.getElementById("adminToggle").textContent = "‚¨ÖÔ∏è Back to Events";
    loadAdminEventOptions();
  }
};

// ---------------------------
// ADMIN TOGGLE
// ---------------------------
function toggleAdminAccess() {
  const panel = document.getElementById("adminPanel");
  const btn = document.getElementById("adminToggle");
  const isAdmin = localStorage.getItem("isAdmin") === "true";
  if (!isAdmin) {
    const pass = prompt("Enter admin password:");
    if (pass === ADMIN_PASSWORD) {
      localStorage.setItem("isAdmin", "true");
      panel.classList.remove("hidden");
      btn.textContent = "‚¨ÖÔ∏è Back to Events";
      loadAdminEventOptions();
      alert("‚úÖ Admin access granted");
    } else alert("‚ùå Incorrect password");
  } else {
    localStorage.removeItem("isAdmin");
    panel.classList.add("hidden");
    btn.textContent = "üîê Admin Access";
  }
}

// ---------------------------
// CREATE EVENT
// ---------------------------
async function createEvent() {
  const name = document.getElementById("newName").value.trim();
  const date = document.getElementById("newDate").value;
  const location = document.getElementById("newLocation").value.trim();
  const price = document.getElementById("newPrice").value || null;
  const image_url = document.getElementById("newImage").value.trim() || null;
  const course_link = document.getElementById("newCourseLink").value.trim() || null;
  const weather_link = document.getElementById("newWeatherLink").value.trim() || null;
  const description = document.getElementById("newDesc").value.trim();
  const msg = document.getElementById("createMsg");

  if (!name || !date || !location) return msg.textContent = "‚ö†Ô∏è Name, date, and location required.";

  const { error } = await supabase.from("events").insert([{ name, date, location, price, image_url, description, course_link, weather_link }]);
  if (error) { msg.textContent = "‚ùå Error creating event."; console.error(error); return; }

  msg.textContent = "‚úÖ Event created!";
  document.querySelectorAll(".new-event-form input, .new-event-form textarea").forEach(i => i.value = "");
  loadEvents();
  loadAdminEventOptions();
}

// ---------------------------
// DELETE EVENT + RELATED DATA
// ---------------------------
async function deleteEvent() {
  const eventId = document.getElementById("teeEventSelect").value;
  if (!eventId) return alert("Select an event to delete.");
  if (!confirm("Are you sure you want to delete this event and all its data?")) return;

  await supabase.from("tee_times").delete().eq("event_id", eventId);
  await supabase.from("rsvps").delete().eq("event_id", eventId);
  const { error } = await supabase.from("events").delete().eq("id", eventId);
  if (error) {
    console.error(error);
    alert("‚ùå Error deleting event.");
  } else {
    alert("üóëÔ∏è Event deleted successfully!");
    loadEvents();
    loadAdminEventOptions();
  }
}

// ---------------------------
// LOAD EVENTS (Public)
// ---------------------------
async function loadEvents() {
  const { data: events } = await supabase.from("events").select("*").order("date", { ascending: true });
  const container = document.getElementById("eventList");
  if (!events?.length) return container.innerHTML = "<p>No events found.</p>";
  container.innerHTML = "";
  for (const ev of events) {
    container.innerHTML += `
      <div class="event-card">
        <div class="event-header">
          <div><div class="event-name">${ev.name}</div><div>${ev.location} ‚Äî ${ev.date}</div></div>
          <div><strong>Price:</strong> ¬£${ev.price || "-"}</div>
        </div>
        ${ev.image_url ? `<img src="${ev.image_url}" class="event-image">` : ""}
        ${ev.description ? `<div class='event-description'>${ev.description}</div>` : ""}
        <div class="event-links">
          ${ev.course_link ? `<a href="${ev.course_link}" target="_blank">Course</a>` : ""}
          ${ev.weather_link ? `<a href="${ev.weather_link}" target="_blank">Weather</a>` : ""}
        </div>
        <button class="admin-btn" id="rsvpBtn_${ev.id}" onclick="showRSVPForm(${ev.id})">üìù RSVP to this event</button>
        <div id="rsvpForm_${ev.id}" class="hidden"></div>
        <div id="teeTimes_${ev.id}" class="tee-display"></div>
      </div>`;
    loadTeeTimes(ev.id);
  }
}

// (rest of script remains the same: RSVP, loadTeeTimes, admin, generate/save tee times)
</script>
</body>
</html>
