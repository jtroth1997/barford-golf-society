<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barford Golf Society | Events</title>
<link rel="icon" href="favicon.ico">
<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  margin: 0;
  padding: 0;
  color: #222;
}
header {
  background: #004d25;
  color: white;
  padding: 1rem;
  text-align: center;
  font-size: 1.5rem;
}
footer {
  background: #004d25;
  color: white;
  text-align: center;
  padding: 10px;
}
.container {
  max-width: 1000px;
  margin: 20px auto;
  padding: 10px;
}
.event-card {
  background: white;
  border-radius: 10px;
  padding: 15px;
  margin-bottom: 15px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  position: relative;
  overflow: hidden;
}
.event-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.event-name {
  font-size: 1.3rem;
  font-weight: bold;
  color: #004d25;
}
.cancel-banner {
  position: absolute;
  top: 40%;
  left: 0;
  width: 100%;
  text-align: center;
  background: rgba(200, 0, 0, 0.85);
  color: white;
  font-weight: 800;
  font-size: 1.8rem;
  padding: 10px 0;
  transform: rotate(-10deg);
  z-index: 5;
  letter-spacing: 2px;
}
.hidden { display: none; }
.admin-panel {
  background: #e6f2ea;
  border: 2px solid #004d25;
  padding: 10px;
  border-radius: 10px;
  margin-bottom: 15px;
}
.admin-btn {
  background: #004d25;
  color: white;
  border: none;
  padding: 8px 14px;
  border-radius: 6px;
  margin-right: 8px;
  cursor: pointer;
  font-size: 0.95rem;
}
.admin-btn:hover { background: #007a3d; }
.rsvp-form {
  background: #f0f0f0;
  padding: 10px;
  border-radius: 8px;
  margin-top: 10px;
}
input, select, textarea {
  padding: 6px;
  border-radius: 5px;
  border: 1px solid #ccc;
  width: 100%;
  margin-bottom: 8px;
}
.tee-group {
  background: #fefefe;
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 10px;
  margin-bottom: 8px;
}
.player-card {
  padding: 6px;
  margin: 3px 0;
  background: #e8f5e9;
  border-radius: 5px;
  cursor: grab;
}
.pair-msg {
  color: #007a3d;
  font-weight: bold;
  margin-top: 6px;
}
</style>
</head>
<body>
<header>Barford Golf Society Events</header>

<div class="container">
  <div style="text-align:center; margin-bottom:10px;">
    <button id="adminToggle" class="admin-btn" onclick="toggleAdminAccess()">üîê Admin Access</button>
  </div>

  <div id="adminPanel" class="admin-panel hidden">
    <div style="display:flex; gap:10px; justify-content:center; margin-bottom:15px;">
      <button class="admin-btn" onclick="showCreateForm()">Create Event</button>
      <button class="admin-btn" onclick="showDeleteForm()">Delete Event</button>
      <button class="admin-btn" onclick="showCancelForm()">Cancel/Uncancel Event</button>
    </div>

    <div id="createForm" class="hidden">
      <h3>Create New Event</h3>
      <input id="newName" placeholder="Event Name">
      <input id="newLocation" placeholder="Location">
      <input id="newDate" type="date">
      <input id="newPrice" type="number" step="0.01" placeholder="Price (¬£)">
      <textarea id="newDesc" placeholder="Event Description"></textarea>
      <input id="newCourse" placeholder="Course Link">
      <input id="newWeather" placeholder="Weather Link">
      <button class="admin-btn" onclick="createEvent()">Confirm Event</button>
    </div>

    <div id="deleteForm" class="hidden">
      <h3>Delete Event</h3>
      <select id="deleteSelect"></select>
      <button class="admin-btn" onclick="deleteEvent()">Delete</button>
    </div>

    <div id="cancelForm" class="hidden">
      <h3>Cancel/Uncancel Event</h3>
      <select id="cancelSelect"></select>
      <button class="admin-btn" onclick="cancelOrUncancel()">Toggle Cancel</button>
    </div>
  </div>

  <div id="eventList">Loading events...</div>
</div>

<footer>¬© 2025 Barford Golf Society</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<script>
const SUPABASE_URL = "https://tzzkgfehtnuizamzlbgr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6emtnZmVodG51aXphbXpsYmdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MzY5ODAsImV4cCI6MjA3ODAxMjk4MH0.2mf4RMbJJvPo0NApywlrDyHuqAMfMyEWxgOS2ZSP4KQ";
const ADMIN_PASSWORD = "barfordadmin";

const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// Admin Access Toggle
function toggleAdminAccess() {
  const panel = document.getElementById("adminPanel");
  const btn = document.getElementById("adminToggle");
  const isAdmin = localStorage.getItem("isAdmin") === "true";
  if (!isAdmin) {
    const pass = prompt("Enter admin password:");
    if (pass === ADMIN_PASSWORD) {
      localStorage.setItem("isAdmin", "true");
      panel.classList.remove("hidden");
      btn.textContent = "‚¨ÖÔ∏è Back to Events";
      loadDropdowns();
    } else alert("‚ùå Incorrect password");
  } else {
    localStorage.removeItem("isAdmin");
    panel.classList.add("hidden");
    btn.textContent = "üîê Admin Access";
  }
}

function showCreateForm() {
  hideAll();
  document.getElementById("createForm").classList.remove("hidden");
}
function showDeleteForm() {
  hideAll();
  document.getElementById("deleteForm").classList.remove("hidden");
}
function showCancelForm() {
  hideAll();
  document.getElementById("cancelForm").classList.remove("hidden");
}
function hideAll() {
  ["createForm", "deleteForm", "cancelForm"].forEach(id => 
    document.getElementById(id).classList.add("hidden")
  );
}

// Load Dropdown Options
async function loadDropdowns() {
  const { data } = await supabase.from("events").select("id,name,cancelled").order("date",{ascending:true});
  const del = document.getElementById("deleteSelect");
  const cancel = document.getElementById("cancelSelect");
  del.innerHTML = cancel.innerHTML = "";
  data.forEach(ev => {
    del.innerHTML += `<option value="${ev.id}">${ev.name}</option>`;
    cancel.innerHTML += `<option value="${ev.id}" data-cancelled="${ev.cancelled}">${ev.name} (${ev.cancelled?"Cancelled":"Active"})</option>`;
  });
}

// Create Event
async function createEvent() {
  const n = document.getElementById("newName").value.trim();
  if (!n) return alert("Enter event name!");
  const data = {
    name: n,
    location: document.getElementById("newLocation").value.trim(),
    date: document.getElementById("newDate").value,
    price: document.getElementById("newPrice").value,
    description: document.getElementById("newDesc").value.trim(),
    course_link: document.getElementById("newCourse").value.trim(),
    weather_link: document.getElementById("newWeather").value.trim(),
    cancelled: false
  };
  const { error } = await supabase.from("events").insert([data]);
  if (error) return alert("‚ùå Error creating event.");
  alert("‚úÖ Event created!");
  loadEvents();
  loadDropdowns();
}

// Delete Event
async function deleteEvent() {
  const id = document.getElementById("deleteSelect").value;
  if (!id) return alert("Select event");
  const pass = prompt("Confirm admin password:");
  if (pass !== ADMIN_PASSWORD) return alert("‚ùå Incorrect password");
  await supabase.from("events").delete().eq("id", id);
  alert("üóëÔ∏è Event deleted");
  loadEvents();
  loadDropdowns();
}

// Cancel / Uncancel Event
async function cancelOrUncancel() {
  const sel = document.getElementById("cancelSelect");
  const id = sel.value;
  const current = sel.options[sel.selectedIndex].dataset.cancelled === "true";
  const pass = prompt("Enter admin password:");
  if (pass !== ADMIN_PASSWORD) return alert("‚ùå Incorrect password");
  const { error } = await supabase.from("events").update({ cancelled: !current }).eq("id", id);
  if (error) alert("‚ùå Error updating event");
  else {
    alert(!current ? "üö´ Event cancelled!" : "‚úÖ Event restored!");
    loadEvents();
    loadDropdowns();
  }
}

// Load Events
async function loadEvents() {
  const { data, error } = await supabase.from("events").select("*").order("date",{ascending:true});
  const list = document.getElementById("eventList");
  if (error) return list.innerHTML = "<p>Error loading events</p>";
  if (!data?.length) return list.innerHTML = "<p>No events yet</p>";
  list.innerHTML = "";
  data.forEach(ev => {
    const banner = ev.cancelled ? `<div class="cancel-banner">üö´ EVENT CANCELLED</div>` : "";
    list.innerHTML += `
      <div class="event-card">
        ${banner}
        <div class="event-header">
          <div><div class="event-name">${ev.name}</div><div>${ev.location} ‚Äî ${ev.date}</div></div>
          <div><strong>¬£${ev.price||""}</strong></div>
        </div>
        ${ev.description?`<p>${ev.description}</p>`:""}
        ${ev.course_link?`<a href="${ev.course_link}" target="_blank">Course Info</a><br>`:""}
        ${ev.weather_link?`<a href="${ev.weather_link}" target="_blank">Weather</a>`:""}
      </div>`;
  });
}
loadEvents();
</script>
</body>
</html>
