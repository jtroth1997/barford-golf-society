<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Events | Barford Golf Society</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
:root {
  --green:#005a2b;
  --gold:#d4af37;
  --light-bg:#f7f7f5;
  --card:#fff;
}
body{font-family:"Inter",sans-serif;margin:0;background:var(--light-bg);color:#1b1b1b;}
header,footer{background:var(--green);color:#fff;padding:15px 0;}
.header-container{display:flex;justify-content:space-between;align-items:center;max-width:1100px;margin:0 auto;padding:0 20px;}
.site-title{color:var(--gold);font-size:1.5rem;font-weight:700;}
.site-nav ul{list-style:none;display:flex;gap:20px;margin:0;padding:0;}
.site-nav a{color:#fff;text-decoration:none;font-weight:600;}
.site-nav a:hover,.active{color:var(--gold);}
.container{max-width:1100px;margin:40px auto;padding:0 20px;}
.event-card{position:relative;background:var(--card);padding:20px;border-radius:10px;margin-bottom:25px;box-shadow:0 3px 8px rgba(0,0,0,0.1);overflow:hidden;}
.event-header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px;}
.event-name{color:var(--green);font-size:1.4rem;font-weight:700;}
.event-image{width:100%;max-height:350px;object-fit:cover;border-radius:10px;margin-top:10px;}
.event-links{margin-top:10px;}
.event-links a{margin-right:10px;color:var(--green);font-weight:600;text-decoration:none;}
.event-links a:hover{text-decoration:underline;}
.event-description{margin-top:10px;white-space:pre-line;}
.cancelled-banner{
  position:absolute;
  top:40%;
  left:-25%;
  width:150%;
  background:rgba(255,0,0,0.7);
  color:white;
  text-align:center;
  font-size:2rem;
  font-weight:800;
  transform:rotate(-25deg);
  z-index:5;
  padding:15px 0;
  pointer-events:none;
}
footer{text-align:center;color:var(--gold);border-top:4px solid var(--gold);margin-top:40px;padding:20px;}

.admin-btn{display:inline-block;background:var(--gold);color:#1b1b1b;font-weight:600;padding:8px 15px;border:none;border-radius:8px;cursor:pointer;margin:10px 0;}
.admin-btn:hover{background:#e0c35a;}
.hidden{display:none;}
.admin-panel{background:#fff;border:2px solid var(--gold);border-radius:10px;padding:20px;margin-bottom:30px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
.tab-buttons{display:flex;gap:10px;margin-bottom:15px;}
.tab-buttons button{flex:1;padding:10px;border:none;cursor:pointer;font-weight:600;border-radius:8px;}
.tab-buttons button.active{background:var(--gold);color:#1b1b1b;}
.tab-section{display:none;}
.tab-section.active{display:block;}
.new-event-form input, .new-event-form textarea {width:100%;margin-bottom:10px;padding:6px;border:1px solid #ccc;border-radius:6px;}
.new-event-form button {background:var(--green);color:#fff;padding:8px 15px;border:none;border-radius:8px;cursor:pointer;font-weight:600;}
.new-event-form button:hover{background:#007a3d;}
</style>
</head>

<body>
<header>
  <div class="header-container">
    <div class="site-title">Barford Golf Society</div>
    <nav class="site-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="events.html" class="active">Events</a></li>
        <li><a href="scores.html">Scores</a></li>
        <li><a href="gallery.html">Gallery</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="container">
  <button id="adminToggle" class="admin-btn" onclick="toggleAdminAccess()">üîê Admin Access</button>

  <div id="adminPanel" class="admin-panel hidden">
    <div class="tab-buttons">
      <button id="tabCreate" class="active" onclick="showTab('createTab', this)">‚ûï Create Event</button>
      <button id="tabDelete" onclick="showTab('deleteTab', this)">üóëÔ∏è Delete Event</button>
      <button id="tabEdit" onclick="showTab('editTab', this)">‚úèÔ∏è Edit / Cancel Event</button>
    </div>

    <!-- CREATE TAB -->
    <div id="createTab" class="tab-section active">
      <h3>‚ûï Create Event</h3>
      <div class="new-event-form">
        <input type="text" id="newName" placeholder="Event name*" required>
        <input type="date" id="newDate" required>
        <input type="text" id="newLocation" placeholder="Location*" required>
        <input type="number" id="newPrice" placeholder="Price (¬£)" step="0.01">
        <input type="text" id="newImage" placeholder="Image URL">
        <input type="text" id="newCourseLink" placeholder="Course link (optional)">
        <input type="text" id="newWeatherLink" placeholder="Weather link (optional)">
        <textarea id="newDesc" placeholder="Description" rows="3"></textarea>
        <button onclick="createEvent()">Create Event</button>
        <div id="createMsg" style="margin-top:8px;font-weight:600;"></div>
      </div>
    </div>

    <!-- DELETE TAB -->
    <div id="deleteTab" class="tab-section">
      <h3>üóëÔ∏è Delete Event</h3>
      <select id="deleteEventSelect" style="width:100%;max-width:400px;margin-bottom:10px;"></select>
      <button onclick="deleteEvent()" style="background:#b22222;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">üóëÔ∏è Delete Selected Event</button>
    </div>

    <!-- EDIT TAB -->
    <div id="editTab" class="tab-section">
      <h3>‚úèÔ∏è Edit / Cancel Event</h3>
      <select id="editEventSelect" style="width:100%;max-width:400px;margin-bottom:10px;"></select>
      <button onclick="toggleCancel()" style="background:#e67e22;color:#fff;padding:6px 12px;border:none;border-radius:6px;cursor:pointer;">‚ùå Toggle Cancel / Uncancel</button>
      <div id="cancelMsg" style="margin-top:10px;font-weight:600;"></div>
    </div>
  </div>

  <h2>Upcoming Events</h2>
  <div id="eventList">Loading events...</div>
</div>

<footer><p>¬© 2025 Barford Golf Society</p></footer>

<script>
const ADMIN_PASSWORD = "westbrom1997";
const SUPABASE_URL = "https://tzzkgfehtnuizamzlbgr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR6emtnZmVodG51aXphbXpsYmdyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI0MzY5ODAsImV4cCI6MjA3ODAxMjk4MH0.2mf4RMbJJvPo0NApywlrDyHuqAMfMyEWxgOS2ZSP4KQ";
const { createClient } = window.supabase;
const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

// ---------- Tab switching ----------
function showTab(tabId, btn) {
  document.querySelectorAll(".tab-section").forEach(t => t.classList.remove("active"));
  document.querySelectorAll(".tab-buttons button").forEach(b => b.classList.remove("active"));
  document.getElementById(tabId).classList.add("active");
  btn.classList.add("active");
}

// ---------- Admin toggle ----------
function toggleAdminAccess() {
  const panel = document.getElementById("adminPanel");
  const btn = document.getElementById("adminToggle");
  const isAdmin = localStorage.getItem("isAdmin") === "true";
  if (!isAdmin) {
    const pass = prompt("Enter admin password:");
    if (pass === ADMIN_PASSWORD) {
      localStorage.setItem("isAdmin", "true");
      panel.classList.remove("hidden");
      btn.textContent = "‚¨ÖÔ∏è Back to Events";
      loadAdminEventOptions();
      alert("‚úÖ Admin access granted");
    } else alert("‚ùå Incorrect password");
  } else {
    localStorage.removeItem("isAdmin");
    panel.classList.add("hidden");
    btn.textContent = "üîê Admin Access";
  }
}

// ---------- Load events ----------
window.onload = () => { loadEvents(); if (localStorage.getItem("isAdmin")==="true"){document.getElementById("adminPanel").classList.remove("hidden");loadAdminEventOptions();}};

async function loadEvents() {
  const { data: events } = await supabase.from("events").select("*").order("date",{ascending:true});
  const container=document.getElementById("eventList");
  if(!events?.length) return container.innerHTML="<p>No events found.</p>";
  container.innerHTML="";
  for(const ev of events){
    const cancelledBanner = ev.cancelled ? `<div class="cancelled-banner">‚ùå EVENT CANCELLED</div>` : "";
    container.innerHTML += `
      <div class="event-card">
        ${cancelledBanner}
        <div class="event-header">
          <div><div class="event-name">${ev.name}</div><div>${ev.location} ‚Äî ${ev.date}</div></div>
          <div><strong>Price:</strong> ¬£${ev.price || "-"}</div>
        </div>
        ${ev.image_url ? `<img src="${ev.image_url}" class="event-image">` : ""}
        ${ev.description ? `<div class='event-description'>${ev.description}</div>` : ""}
        <div class="event-links">
          ${ev.course_link ? `<a href="${ev.course_link}" target="_blank">Course</a>` : ""}
          ${ev.weather_link ? `<a href="${ev.weather_link}" target="_blank">Weather</a>` : ""}
        </div>
      </div>`;
  }
  loadAdminEventOptions();
}

// ---------- Create ----------
async function createEvent(){
  const name=document.getElementById("newName").value.trim();
  const date=document.getElementById("newDate").value;
  const location=document.getElementById("newLocation").value.trim();
  const price=document.getElementById("newPrice").value||null;
  const image_url=document.getElementById("newImage").value.trim()||null;
  const description=document.getElementById("newDesc").value.trim();
  const course_link=document.getElementById("newCourseLink").value.trim()||null;
  const weather_link=document.getElementById("newWeatherLink").value.trim()||null;
  const msg=document.getElementById("createMsg");
  if(!name||!date||!location)return msg.textContent="‚ö†Ô∏è Name, date and location required.";
  const {error}=await supabase.from("events").insert([{name,date,location,price,image_url,description,course_link,weather_link,cancelled:false}]);
  msg.textContent=error?"‚ùå Error creating event.":"‚úÖ Event created!";
  loadEvents();
}

// ---------- Delete ----------
async function deleteEvent(){
  const id=document.getElementById("deleteEventSelect").value;
  if(!id)return alert("Select event to delete.");
  if(!confirm("Are you sure? This will delete event, RSVPs and tee times."))return;
  await supabase.from("tee_times").delete().eq("event_id",id);
  await supabase.from("rsvps").delete().eq("event_id",id);
  await supabase.from("events").delete().eq("id",id);
  alert("üóëÔ∏è Event deleted.");
  loadEvents();
}

// ---------- Cancel/Uncancel ----------
async function toggleCancel(){
  const id=document.getElementById("editEventSelect").value;
  const msg=document.getElementById("cancelMsg");
  if(!id)return alert("Select an event first.");
  const pass=prompt("Enter admin password to confirm:");
  if(pass!==ADMIN_PASSWORD)return alert("‚ùå Incorrect password.");
  const { data }=await supabase.from("events").select("cancelled").eq("id",id).single();
  const newVal=!data.cancelled;
  await supabase.from("events").update({cancelled:newVal}).eq("id",id);
  msg.textContent=newVal?"üö´ Event marked as CANCELLED.":"‚úÖ Event marked as ACTIVE.";
  loadEvents();
}

// ---------- Admin dropdown refresh ----------
async function loadAdminEventOptions(){
  const { data }=await supabase.from("events").select("id,name,date,cancelled").order("date",{ascending:true});
  if(!data)return;
  const opts=data.map(e=>`<option value='${e.id}'>${e.name} (${e.date})${e.cancelled?" - CANCELLED":""}</option>`).join("");
  ["deleteEventSelect","editEventSelect"].forEach(sel=>{
    const el=document.getElementById(sel);
    if(el)el.innerHTML=`<option value=''>Select event</option>${opts}`;
  });
}
</script>
</body>
</html>
